# Story 3.1: Install and Configure Style Dictionary

## Status

**DEFERRED** - Style Dictionary removed from pipeline (2025-08-07)

## Story

**As a** Design System Engineer,
**I want** Style Dictionary installed and configured in the monorepo,
**so that** I have the core engine needed to perform token transformations.

## Deferral Notice

This story has been **deferred** as of 2025-08-07. Style Dictionary v4.0.0 was initially implemented but then removed due to:

1. **Complex Reference Resolution**: 604+ unresolved token references causing build failures
2. **Pipeline Simplification**: Focus shifted to core Token Studio workflow stability  
3. **Future Strategy**: Plan to re-implement with Style Dictionary v5+ when developer consumption is needed

**Current Status**: Epic 2 (Designer Workflow) is complete and functional. Epic 3 (Developer Consumption) is paused until Style Dictionary re-integration is needed.

## Acceptance Criteria

1. Style Dictionary 4.0.0 is installed as a project dependency with proper configuration
2. A comprehensive style-dictionary.config.js file is created with multi-platform support
3. The configuration supports tokensource.json as the input source with proper token format
4. Initial build process generates output directories and validates the transformation pipeline
5. The configuration is extensible to support future platforms and output formats
6. Integration with existing npm scripts and project build workflow is established

## Tasks / Subtasks

- [ ] Task 1: Install Style Dictionary dependency (AC: 1)
  - [ ] Install Style Dictionary 4.0.0 via npm with exact version specification
  - [ ] Update package.json with proper dependency configuration
  - [ ] Verify installation integrity and version compatibility with Node.js 20.11.1
  - [ ] Update package-lock.json with reproducible dependency lock
- [ ] Task 2: Create comprehensive Style Dictionary configuration (AC: 2, 3, 5)
  - [ ] Create style-dictionary.config.js with multi-platform architecture
  - [ ] Configure tokensource.json as primary input source
  - [ ] Set up platform-specific output configurations (CSS, Dart)
  - [ ] Define token format specifications and validation rules
  - [ ] Configure extensible platform architecture for future formats
- [ ] Task 3: Configure token input source integration (AC: 3)
  - [ ] Configure Style Dictionary to read tokensource.json (118,871 bytes)
  - [ ] Set up token format parsing for Token Studio structure
  - [ ] Configure token type recognition ($type, $value, $description)
  - [ ] Set up token reference resolution for multi-brand tokens
  - [ ] Validate input source compatibility with existing token structure
- [ ] Task 4: Set up output directory structure (AC: 4)
  - [ ] Create dist/ directory structure for platform-specific outputs
  - [ ] Configure CSS output directory (dist/css/)
  - [ ] Configure Dart output directory (dist/dart/)
  - [ ] Set up build artifacts organization and naming conventions
  - [ ] Configure output file cleanup and regeneration processes
- [ ] Task 5: Create initial build process (AC: 4, 6)
  - [ ] Implement npm run build:tokens script for Style Dictionary execution
  - [ ] Create validation script for transformation pipeline integrity
  - [ ] Set up build process error handling and logging
  - [ ] Configure build process integration with existing npm scripts
  - [ ] Test initial build execution with current tokensource.json
- [ ] Task 6: Validate and test Style Dictionary integration (AC: 1-6)
  - [ ] Test complete build process from tokensource.json to output files
  - [ ] Validate token transformation accuracy and completeness
  - [ ] Test multi-brand token handling (bet9ja dark, Content Typography)
  - [ ] Verify output file generation and structure
  - [ ] Test integration with existing project build workflow

## Dev Notes

### Previous Story Context

**Epic 2 Complete Foundation:**
- ✅ **Dynamic multi-brand pipeline** with 5 active token sets (118,871 bytes tokensource.json)
- ✅ **GitHub repository integration** with automated CI/CD (2-minute sync)
- ✅ **Token Studio connectivity** via raw GitHub URL
- ✅ **Designer workflow automation** complete end-to-end

**Current System Ready for Style Dictionary:**
- **tokensource.json:** 118,871 bytes with validated multi-brand token structure
- **Token Sets:** core, global, components, bet9ja dark, Content Typography
- **CI/CD Pipeline:** Automated token updates ready for platform generation
- **Project Structure:** dist/ directory ready for platform-specific outputs

### Architecture Context

[Source: architecture/02-2-tech-stack.md]
- **Core Engine:** Style Dictionary 4.0.0 - Token transformation engine
- **Language:** TypeScript 5.4.5 - Configuration and scripts
- **Runtime:** Node.js 20.11.1 - Execution environment

[Source: architecture/07-7-source-tree.md]
- **Input:** tokensource.json (root level, 118,871 bytes)
- **Configuration:** style-dictionary.config.js (root level)
- **Output:** dist/ directory with platform-specific outputs
- **Scripts:** Additional build scripts in scripts/ directory

[Source: architecture/01-1-high-level-architecture.md]
- **Architectural Style:** Build-Time Pipeline (not a running service)
- **Primary Data Flow:** tokensource.json → Style Dictionary build → platform outputs
- **Patterns:** Adapter Pattern via Style Dictionary for multi-platform output

### Functional Requirements Context

[Source: docs/prd/02-2-requirements.md]
- **FR2:** System must use Style Dictionary engine to transform tokensource.json into platform-specific outputs
- **Output Requirements:** CSS Custom Properties and Dart theme files

[Source: docs/prd/08-8-epic-3-details-developer-consumption-pipeline.md]
- **Epic Goal:** "Transform single source of truth into multiple, platform-specific formats"
- **Success Criteria:** "Core engine needed to perform token transformations"

### Style Dictionary Configuration Requirements

**Configuration Architecture:**
```javascript
// style-dictionary.config.js
module.exports = {
  source: ['tokensource.json'],  // Input: 118,871 bytes multi-brand tokens
  platforms: {
    css: {
      transformGroup: 'css',
      buildPath: 'dist/css/',
      files: [{
        destination: 'tokens.css',
        format: 'css/variables'
      }]
    },
    dart: {
      transformGroup: 'flutter',  
      buildPath: 'dist/dart/',
      files: [{
        destination: 'tokens.dart',
        format: 'flutter/class.dart'
      }]
    }
  }
};
```

**Input Source Configuration:**
- **Primary Source:** tokensource.json (118,871 bytes)
- **Token Format:** Token Studio format with $type, $value, $description
- **Multi-Brand Support:** 5 token sets with dynamic scaling
- **Reference Resolution:** Support for {token.reference} syntax

### Token Structure Analysis

**Current tokensource.json Structure:**
```json
{
  "core": {
    "color": {
      "primary": {
        "$type": "color",
        "$value": "#007bff",
        "$description": "Primary brand color"
      }
    }
  },
  "bet9ja dark": {
    "color": {
      "background": {
        "$type": "color", 
        "$value": "{core.color.neutral.900}",
        "$description": "Dark theme background"
      }
    }
  }
}
```

**Style Dictionary Compatibility Requirements:**
- Token type recognition ($type → Style Dictionary types)
- Value parsing ($value with reference resolution)
- Description preservation ($description → output comments)
- Multi-brand token set handling
- Token reference resolution across sets

### Platform Output Specifications

**CSS Output Requirements:**
```css
/* Expected dist/css/tokens.css format */
:root {
  --color-primary: #007bff;
  --color-background: #1a1a1a; /* From bet9ja dark theme */
  --typography-h1-font-size: 2rem;
  /* ~500+ CSS Custom Properties */
}
```

**Dart Output Requirements:**
```dart
// Expected dist/dart/tokens.dart format
class DesignTokens {
  static const Color colorPrimary = Color(0xFF007BFF);
  static const Color colorBackground = Color(0xFF1A1A1A);
  static const double typographyH1FontSize = 32.0;
  // ~500+ Dart constants
}
```

### Build Process Integration

**NPM Script Configuration:**
```json
{
  "scripts": {
    "build:tokens": "style-dictionary build",
    "validate:tokens": "node scripts/validate-tokens.js",
    "build": "npm run build:tokens && npm run build:app"
  }
}
```

**Build Workflow Integration:**
1. **Input Validation:** Verify tokensource.json structure and size
2. **Style Dictionary Build:** Transform tokens to platform outputs
3. **Output Validation:** Verify generated files meet requirements
4. **Integration Testing:** Test outputs work with target platforms

### Error Handling and Validation

**Input Validation Requirements:**
- tokensource.json file existence and accessibility
- JSON structure validation and parsing
- Token format compliance ($type, $value, $description)
- File size validation (118,871 bytes expected)

**Build Process Error Handling:**
- Style Dictionary configuration validation
- Token transformation error reporting
- Output directory creation and permissions
- Platform-specific build failure handling

**Output Validation Requirements:**
- Generated file existence and structure
- CSS syntax validation for web compatibility
- Dart syntax validation for Flutter compatibility  
- Token count verification against input source

### Future Extensibility Requirements

**Platform Expansion Readiness:**
```javascript
// Future platform configurations
platforms: {
  css: { /* CSS configuration */ },
  dart: { /* Dart configuration */ },
  swift: { /* Future iOS support */ },
  android: { /* Future Android XML support */ },
  json: { /* Future API consumption */ }
}
```

**Configuration Modularity:**
- Separate transform configurations per platform
- Reusable format definitions
- Extensible build path patterns
- Configurable output naming conventions

### Integration with Existing Pipeline

**Epic 2 Integration Points:**
- **Input:** tokensource.json automatically updated via CI/CD
- **Trigger:** Style Dictionary builds respond to token changes
- **Output:** Platform files ready for developer consumption

**Epic 3 Progression:**
- **Story 3.1:** Style Dictionary foundation (current)
- **Story 3.2:** CSS transformation implementation  
- **Story 3.3:** Dart transformation implementation
- **Story 3.4:** CI/CD automation for platform builds

### Performance Considerations

**Build Performance Requirements:**
- **Input Processing:** 118,871 bytes tokensource.json parsing <5 seconds
- **Transformation:** Multi-platform build process <30 seconds
- **Output Generation:** ~500+ tokens to platform files <10 seconds
- **Total Build Time:** Complete token transformation <45 seconds

**Memory Management:**
- Efficient JSON parsing for large token files
- Platform-specific memory optimization
- Build artifact cleanup and management
- Concurrent platform processing where possible

## Testing

### Testing Standards

[Source: architecture/09-9-coding-standards-and-test-strategy.md]
- **Test Framework:** Jest 29.7.0 for build process validation
- **Test Focus:** Token transformation accuracy and build pipeline reliability
- **Integration Testing:** Validate complete tokensource.json → platform outputs

### Specific Testing Requirements

**Style Dictionary Installation Testing:**
- Verify Style Dictionary 4.0.0 installation and version compatibility
- Test npm script execution and command-line interface
- Validate configuration file loading and parsing
- Test integration with existing project build process

**Configuration Validation Testing:**
- Test style-dictionary.config.js loads without errors
- Verify tokensource.json input source recognition
- Test platform configuration parsing and validation
- Validate output directory creation and file generation

**Token Transformation Testing:**
- Test complete build process with current tokensource.json (118,871 bytes)
- Verify all 5 token sets are processed correctly
- Test token reference resolution across brand boundaries
- Validate multi-brand token handling (bet9ja dark, Content Typography)

**Build Process Integration Testing:**
- Test npm run build:tokens executes successfully
- Verify build process error handling and reporting
- Test integration with existing npm scripts and build workflow
- Validate build artifacts generation in dist/ directory

**Output Validation Testing:**
- Verify CSS and Dart output directories are created
- Test generated files have expected structure and content
- Validate token count matches input source (~500+ tokens)
- Test platform-specific output format compliance

## Change Log

| Date | Version | Description | Author |
| ---- | ------- | ----------- | ------ |
| 2025-08-06 | 1.0 | Initial story creation | Sarah (PO) |

## Dev Agent Record

_This section will be populated by the development agent during implementation_

### Agent Model Used

_To be filled by dev agent_

### Debug Log References

_To be filled by dev agent_

### Completion Notes List

_To be filled by dev agent_

### File List

_To be filled by dev agent_

## QA Results

_This section will be populated by QA Agent during review_