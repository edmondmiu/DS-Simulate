# Story 2.6: Fix Token Set Metadata Configuration

## Status
Draft

## Story
**As a** Design System Engineer,
**I want** the `$metadata.json` file to accurately reflect all existing token sets in the correct order,
**so that** the consolidate/split scripts process all token files correctly and Token Studio can import all available sets.

## Acceptance Criteria
1. The `$metadata.json` tokenSetOrder includes all existing token files
2. The order matches the intended theme hierarchy (core → global → theme variants → brand variants → components → typography)
3. Token Studio can successfully import all token sets listed in the metadata
4. The consolidate script processes all token sets in the correct order
5. The split script recreates all token sets based on the updated metadata
6. All existing themes continue to function with the corrected metadata

## Tasks / Subtasks
- [ ] Task 1: Audit current token files vs metadata configuration (AC: 1)
  - [ ] List all existing token files in the tokens/ directory
  - [ ] Compare with current tokenSetOrder in $metadata.json
  - [ ] Identify missing token sets: "global light", "bet9ja light"
  - [ ] Document the discrepancies and their impact on Token Studio imports
- [ ] Task 2: Define correct token set hierarchy and order (AC: 2)
  - [ ] Establish logical processing order: core (foundation) → global (semantic) → theme variants → brand overrides → components → typography
  - [ ] Create updated tokenSetOrder: ["core", "global", "global light", "components", "bet9ja dark", "bet9ja light", "Content Typography"]
  - [ ] Validate order supports proper token reference resolution
- [ ] Task 3: Update $metadata.json with complete token set list (AC: 1, 2)
  - [ ] Update tokenSetOrder array with all 7 token sets
  - [ ] Ensure proper JSON formatting and validation
  - [ ] Create backup of current metadata before changes
- [ ] Task 4: Test consolidate script with updated metadata (AC: 4)
  - [ ] Run consolidate script and verify all 7 token sets are processed
  - [ ] Confirm tokensource.json includes all token sets in correct order
  - [ ] Validate token references resolve correctly across sets
  - [ ] Check that empty token sets (global light, bet9ja light) are handled gracefully
- [ ] Task 5: Test split script with updated metadata (AC: 5)
  - [ ] Run split script from updated tokensource.json
  - [ ] Verify all 7 token files are recreated correctly
  - [ ] Confirm file naming handles spaces correctly ("global light.json", "bet9ja light.json")
  - [ ] Validate round-trip integrity (consolidate → split → consolidate produces identical results)
- [ ] Task 6: Validate Token Studio import functionality (AC: 3, 6)
  - [ ] Test Token Studio import with updated tokensource.json
  - [ ] Verify all token sets appear in Token Studio interface
  - [ ] Test all four existing themes still function correctly
  - [ ] Confirm theme token set references resolve properly

## Dev Notes

### Previous Story Insights
This issue was discovered during Epic 2 completion when Token Studio imports were failing to show expected token sets. The root cause is incomplete metadata configuration that doesn't reflect the actual token file structure.

### Current Token File Structure
**Existing Token Files (7 total):**
- `core.json` - Foundation color ramps and primitives (✅ in metadata)
- `global.json` - Semantic tokens (typography, spacing) (✅ in metadata)  
- `global light.json` - Light theme overrides (❌ missing from metadata, currently empty)
- `components.json` - Component-specific tokens (✅ in metadata)
- `bet9ja dark.json` - Brand dark theme tokens (✅ in metadata)
- `bet9ja light.json` - Brand light theme tokens (❌ missing from metadata, currently empty)
- `Content Typography.json` - Typography tokens (✅ in metadata)

**Current Metadata (Incomplete):**
```json
{
  "tokenSetOrder": [
    "core",
    "global", 
    "components",
    "bet9ja dark",
    "Content Typography"
  ]
}
```

### Theme Configuration Impact
**Current Themes Reference Missing Sets:**
- Base Light theme: references `"global light": "enabled"` (missing from metadata)
- Bet9ja Light theme: references `"bet9ja light": "enabled"` (missing from metadata)

This causes Token Studio import failures because themes reference token sets that aren't defined in the metadata.

### Script Processing Requirements
[Source: architecture/07-7-source-tree.md, stories/1.2.implement-consolidate-script.story.md]
- **Consolidate Script:** Processes token sets in tokenSetOrder sequence
- **Split Script:** Recreates token files based on tokensource.json top-level keys
- **Import-Export Script:** Syncs tokenstudio_export/ to tokens/ maintaining file naming

### Token Set Hierarchy Logic
**Recommended Processing Order:**
1. **core** - Foundation (color ramps, primitives) - source for all themes
2. **global** - Semantic tokens (typography, spacing) - base semantic layer
3. **global light** - Light theme overrides - theme variant layer
4. **components** - Component-specific tokens - component layer
5. **bet9ja dark** - Brand dark overrides - brand variant layer
6. **bet9ja light** - Brand light overrides - brand variant layer  
7. **Content Typography** - Typography specifications - typography layer

### Technical Constraints
- Token Studio requires all referenced token sets to exist in metadata
- Consolidate script processes sets in exact tokenSetOrder sequence
- Split script must handle spaces in token set names correctly
- Empty token sets (global light, bet9ja light) must be preserved in pipeline
- Round-trip validation must maintain exact byte-for-byte consistency

## Testing
### Testing Standards
- **Metadata Validation:** JSON syntax and structure validation
- **Script Integration:** Test consolidate and split scripts with updated metadata
- **Token Studio Import:** Verify complete import functionality
- **Round-trip Testing:** Ensure consolidate → split → consolidate produces identical results
- **Theme Functionality:** Validate all existing themes continue to work

## Change Log
| Date | Version | Description | Author |
|------|---------|-------------|--------|
| [Current Date] | 1.0 | Initial story creation for Epic 2 | Scrum Master |

## Dev Agent Record
*This section will be populated by the development agent during implementation*

### Agent Model Used
*To be filled by dev agent*

### Debug Log References
*To be filled by dev agent*

### Completion Notes List
*To be filled by dev agent*

### File List
*To be filled by dev agent*

## QA Results
*Results from QA Agent review will be populated here*